
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta content="noindex" name="robots" />

<meta property="og:title" content="Ground Reaction force prediction" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://anyscript.org/anymocap/grf-prediction.html" />
  
<meta property="og:site_name" content="AMMR Documentation" />
  
<meta property="og:description" content="Background: Motion capture data is often recorded without force plates. In traditional inverse dynamics, this would make it impossible to perform a dynamic analysis. However, AnyBody has the possib..." />
  
<meta property="og:image" content="https://anyscript.org/_images/grf_output.png" />
  
<meta property="og:image:alt" content="AMMR Documentation" />
  
    <title>Ground Reaction force prediction &#8212; AMMR v2.4.1-beta Documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >let toggleHintShow = 'Click to show';</script>
    <script >let toggleHintHide = 'Click to hide';</script>
    <script >let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="The AnyMoCap Framework" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/AMMR.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../getting_started.html">
   Getting Started with AMMR
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ammr_installation.html">
     Installing Latest AMMR Files
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about.html">
   About the model repository
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelog.html">
     Changelog
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../contribute.html">
     Contribute to Model Development
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../legal.html">
     Legal, Trademarks and Copyrights
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../bm_config/index.html">
   Configuring the Body Model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/leg.html">
     Leg Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/arm.html">
     Arm Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/trunk.html">
     Trunk Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/mannequin.html">
     Mannequin Driver Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/scaling.html">
     Scaling Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/joint_type.html">
     Joint Type Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/other.html">
     Other Parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/bm_plugin.html">
     Body Model Plugin (BM-Plugin)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/bm_statements.html">
     All BodyModel parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bm_config/bm_constants.html">
     All BodyModel constants
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../body/models.html">
   Body Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/lumbar_spine_model.html">
     The Lumbar Spine Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/cervical_spine_model.html">
     The Cervical Spine Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/thoracic_model.html">
     Thoracic spine model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/shoulder_arm_model.html">
     The Shoulder Arm Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/detailed_hand_model.html">
     Detailed hand model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/regensburg_ulm_hand_model.html">
     Regensburg-Ulm hand model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/leg_model.html">
     The “Leg” Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/leg_tlem_model.html">
     Twente Lower Extremity Model v.1.2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/leg_tlem2_model.html">
     Twente Lower Extremity Model v.2.1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/glasgow_maastricht_foot_model.html">
     GM Foot model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/symmetric_mandible_model.html">
     The Symmetric Mandible
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../body/aalborg_mandible.html">
     The Aalborg mandible
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Applications/index.html">
   Example Gallery
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/index.html">
     Ergonomics and ADLs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/AirlinePassenger.html">
       Airline passenger
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/FreePosture.html">
       Free posture Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/PedalDemo.html">
       Pedel demo simple
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/PedalDemoConditional.html">
       Pedel demo
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/PosturePredictionModel.html">
       Posture Prediction Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/SeatedHuman.html">
       Seated Human
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/Squat.html">
       Squat
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/StandingLift.html">
       Lifting Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/StandingModel.html">
       Standing Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Daily-activities-and-ergonomics/WheelTurn.html">
       Hand crank model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Applications/Orthopedics_and_rehab/index.html">
     Orthopedics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/FacetJointModel.html">
       Facet Joint Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/FemoralTorsionTool.html">
       Femoral Torsion tool
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/KneeForcesExample.html">
       Knee forces example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/KneeSimulator.html">
       Knee Simulator Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/SpineFixationWithForceDependentKinematics.html">
       Spine Fixation Model using Force Dependent Kinematics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/THA-KneeBendDemo.html">
       Total Hip Arthroplasty (THA) Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Orthopedics_and_rehab/WheelChairRancho.html">
       Wheel Chair model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Applications/Sports/index.html">
     Sports
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/ArmCurl.html">
       Arm curl
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/BenchPress.html">
       Bench Press
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/BikeModel.html">
       Bike Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/BikeModel2D.html">
       Bike Model 2D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/CrossTrainer.html">
       Cross Trainer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/LegPressMachine.html">
       Leg Press Machine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Sports/PushUp.html">
       Push Up
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Applications/Other/index.html">
     Other
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/ExoConceptTrunk_BoxLift.html">
       Trunk exoskeleton concept model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/ExoConcept_BoxLift.html">
       Exoskeleton concept model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/IndexFingerModel.html">
       Index finger model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/JumpingJack.html">
       Jumping Jack
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/StandingModelScalingDisplay.html">
       Standing Model Scaling Display
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/StatisticalScalingPlugin.html">
       Statistical Scaling Plugin
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Other/UlmRatHindLimbModel.html">
       Rat Hindlimb model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Applications/Validation/index.html">
     Validation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/AalborgMandible.html">
       The Aalborg Mandible model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/BergmannGH.html">
       Bergmann GH
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/EvaluateJointStrength.html">
       Evaluate joint strength
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/EvaluateMomentArms.html">
       Evaluate moment arms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/GaitVaughan.html">
       Gait Vaughan
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/MandibleModel.html">
       Symmetric Mandible example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Applications/Validation/WilkeSpinePressure.html">
       Wilke Spine Disc Pressure Model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Guides
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../creating_model_from_scratch.html">
   Creating a Human model from scratch
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Scaling/intro.html">
   Introduction to Scaling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Scaling/lesson1.html">
     Lesson 1: Joint to Joint Scaling Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Scaling/lesson2.html">
     Lesson 2: Scaling based on External Body Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Scaling/lesson3.html">
     Lesson 3: Scaling using segmental scaling vectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   The AnyMoCap Framework
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Ground Reaction force prediction
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-ground-force-prediction-to-a-model">
   Adding ground force prediction to a model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-the-class-templates">
     Including the class templates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-the-grf-prediction-classes">
     Adding the GRF prediction classes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-new-residuals-hand-of-god">
     Setting up new residuals (Hand of God)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-model">
   Running the model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grf-prediction-trouble-shooting">
   GRF prediction trouble shooting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-closer-look-at-the-grf-template">
   A closer look at the GRF template
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-templates-footplateconditionalcontact">
     Class templates: FootPlateConditionalContact
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Ground Reaction force prediction</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-ground-force-prediction-to-a-model">
   Adding ground force prediction to a model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-the-class-templates">
     Including the class templates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-the-grf-prediction-classes">
     Adding the GRF prediction classes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-new-residuals-hand-of-god">
     Setting up new residuals (Hand of God)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-model">
   Running the model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grf-prediction-trouble-shooting">
   GRF prediction trouble shooting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-closer-look-at-the-grf-template">
   A closer look at the GRF template
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-templates-footplateconditionalcontact">
     Class templates: FootPlateConditionalContact
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="ground-reaction-force-prediction">
<h1>Ground Reaction force prediction<a class="headerlink" href="#ground-reaction-force-prediction" title="Permalink to this headline">#</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h2>
<p>Motion capture data is often recorded without force plates. In traditional
inverse dynamics, this would make it impossible to perform a dynamic analysis.
However, AnyBody has the possibility to predict ground reaction forces (GRF), so
you can make inverse dynamics models based on recorded motion without GRF force
measurement (Fluit et al., 2014; Jung et al., 2014).</p>
<p>GRF prediction relies on conditional contacts added to the feet of the model.
The conditional contacts work as force actuators to generate the normal and
frictional forces necessary to balance model. Mathematically, the actuators are
modeled similarly to muscles, and the muscle recruitment optimization determines
the contact forces. The effect is that the model will utilize the ground
reactions if that can minimize the muscle activity.</p>
<p>Adding conditional contacts to a model can be rather complex, but we have
created an AnyScript class template that makes the process much easier. The
class template will generate all the necessary AnyScript code. Thus, adding GRF
prediction is similar to adding force plates to a model.</p>
<p>This new functionality is now part of the AnyBody Managed Model Repository
(AMMR).</p>
</div>
<div class="section" id="adding-ground-force-prediction-to-a-model">
<h2>Adding ground force prediction to a model<a class="headerlink" href="#adding-ground-force-prediction-to-a-model" title="Permalink to this headline">#</a></h2>
<p>The <span class="xref std std-ref">GRF example model</span>
is already preconfigured to use the GRF prediction. But
if you need to add GRF prediction to new model the following outlines the
procedure.</p>
<div class="section" id="including-the-class-templates">
<h3>Including the class templates<a class="headerlink" href="#including-the-class-templates" title="Permalink to this headline">#</a></h3>
<p>The class template is already included in the AnyMoCap framework, so this step
can be skipped. However, when using GRF prediction in other models it is
necessary to include the following line at the beginning of the model:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="s">&quot;&lt;ANYBODY_PATH_AMMR&gt;/Tools/GRFPrediction/FootPlateConditionalContact.any&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-the-grf-prediction-classes">
<h3>Adding the GRF prediction classes<a class="headerlink" href="#adding-the-grf-prediction-classes" title="Permalink to this headline">#</a></h3>
<p>In the AnyMoCap models GRF prediction is enabled by setting the following
setting:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="cp">#define</span> <span class="n">MOCAP_USE_GRF_PREDICTION</span> <span class="x x-Options">ON</span>
</pre></div>
</div>
<p>The next step is to add the class template to generate the AnyScript code for
GRF prediction. These classes replaces the Force plate classes in the AnyMoCap
model.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="c1">// EXCLUDE THE EXISTING C3D FORCE PLATES</span>
<span class="c1">// ForcePlateAutoDetection Plate1(</span>
<span class="c1">//    PLATE_NO=1,</span>
<span class="c1">//     HeightTolerance = 0.07,</span>
<span class="c1">//    VelThreshold = 2.2,</span>
<span class="c1">//    FORCEPLATE_TYPE = 4,</span>
<span class="c1">//   ALLOW_MULTI_LIMB_CONTACT = OFF</span>
<span class="c1">// ) = { };</span>


<span class="n">FootPlateConditionalContact</span> <span class="n">GRF_Prediction_Right</span><span class="p">(</span>
    <span class="n">NORMAL_DIRECTION</span> <span class="o">=</span> <span class="s">&quot;Y&quot;</span><span class="p">,</span>
    <span class="n">NUMBER_OF_NODES</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">NODES_FOLDER</span> <span class="o">=</span> <span class="n">FootNodes</span><span class="p">,</span>
    <span class="n">PLATE_BASE_FRAME</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">EnvironmentModel</span><span class="p">.</span><span class="n">GlobalRef</span>
<span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">CreateFootContactNodes25</span> <span class="n">FootNodes</span><span class="p">(</span>
        <span class="n">foot_ref</span><span class="o">=</span><span class="n">Main</span><span class="p">.</span><span class="n">HumanModel</span><span class="p">.</span><span class="n">BodyModel</span><span class="p">.</span><span class="n">Right</span><span class="p">.</span><span class="n">Leg</span><span class="p">.</span><span class="n">Seg</span><span class="p">.</span><span class="n">Foot</span>
    <span class="p">)</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>See below for more information on the GRF prediction classes.</p>
</div>
<div class="section" id="setting-up-new-residuals-hand-of-god">
<h3>Setting up new residuals (Hand of God)<a class="headerlink" href="#setting-up-new-residuals-hand-of-god" title="Permalink to this headline">#</a></h3>
<p>Adding conditional contacts to the feet is not enough. The AnyMoCap model comes
reactions forces applied to the pelvis. These are the reactions that carry any
inconsistencies between the model and force plate data, and they must be removed
for ground reaction force prediction.</p>
<p>Instead, we apply another type of residuals to the model, so the solver does not
fail if the model fails to balance. These residuals are implemented as
recruitment actuators from pelvis to the global reference frame. These actuators
are implemented similarly to how muscles work. However, they are very weak, so
the recruitment solver will only activate them if nothing else can balance the
model.</p>
<p>In the AnyMoCap models the new residuals are activated by default when
<code class="docutils literal notranslate"><span class="pre">MOCAP_USE_GRF_PREDICTION</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>. So no need to do anything.</p>
<p>In other models the Weak residuals must be added manually, or by including the
following file in your model:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">Main</span><span class="p">.</span><span class="n">ModelEnvironmentConnection</span>  <span class="o">=</span> <span class="p">{</span>
    <span class="cp">#include</span> <span class="s">&quot;&lt;ANYBODY_PATH_AMMR&gt;/Tools/GRFPrediction/WeakResiduals.any&quot;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The file <code class="docutils literal notranslate"><span class="pre">WeakResiduals.any</span></code> does the job of removing the ‘Hand of God’ and adding
the new, weak residuals. Again this is handled automatically in the AnyMoCap
based models.</p>
</div>
</div>
<div class="section" id="running-the-model">
<h2>Running the model<a class="headerlink" href="#running-the-model" title="Permalink to this headline">#</a></h2>
<p>The model is run in the same way as other models. The only difference is that it
now uses GRF prediction instead of force plates data.</p>
<div class="figure align-center">
<img alt="../_images/grf_output.png" src="../_images/grf_output.png" />
</div>
<p>It may be necessary to adjust the parameters of the GRF prediction class to
obtain a good prediction of the ground reactions. This is especially important
around heel strike and toe-off, where the model can have problems.</p>
</div>
<div class="section" id="grf-prediction-trouble-shooting">
<h2>GRF prediction trouble shooting<a class="headerlink" href="#grf-prediction-trouble-shooting" title="Permalink to this headline">#</a></h2>
<p>Here are some things to check if a GRF prediction model fails running inverse
dynamic:</p>
<ul class="simple">
<li><p>Direction of gravity is it specified correctly?  this needs to be correct in
two places the Gravity property of the study in the LabSpecific.any data and in
the definition of the force plates setting the variable <code class="docutils literal notranslate"><span class="pre">NORMAL_DIRECTION</span></code>.</p></li>
<li><p>In the file Forceplate_GRFprediction.any try to increase the property <code class="docutils literal notranslate"><span class="pre">LimitDistHigh</span></code>,
this controls when contact can occur so if the number is higher the foot do
not need to be as close to the ground before contact can occur, see also
LimitVelHigh it controls speed limit.</p></li>
<li><p>Unrealistic accelerations of the model could be the reason if your data are
not filtered correctly</p></li>
<li><p>The model is using a weak residual to the ground that helps holding the balance
in the model if the feet contact are not enough, this is defined in  the file
“Tools/GRFPrediction/Weakresidual.any” here  you can increase the strength
of the artificial muscles, but this will lead to higher residuals so be
careful.</p></li>
</ul>
</div>
<div class="section" id="a-closer-look-at-the-grf-template">
<h2>A closer look at the GRF template<a class="headerlink" href="#a-closer-look-at-the-grf-template" title="Permalink to this headline">#</a></h2>
<p>Finally, we can take a closer look at the <code class="docutils literal notranslate"><span class="pre">FootPlateConditionalContact</span></code> template.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">FootPlateConditionalContact</span> <span class="n">GRF_Prediction_Right</span><span class="p">(</span>
    <span class="n">NORMAL_DIRECTION</span> <span class="o">=</span> <span class="s">&quot;Y&quot;</span><span class="p">,</span>
    <span class="n">NUMBER_OF_NODES</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">NODES_FOLDER</span> <span class="o">=</span> <span class="n">FootNodes</span><span class="p">,</span>
    <span class="n">PLATE_BASE_FRAME</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">EnvironmentModel</span><span class="p">.</span><span class="n">GlobalRef</span>
<span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">CreateFootContactNodes25</span> <span class="n">FootNodes</span><span class="p">(</span>
        <span class="n">foot_ref</span><span class="o">=</span><span class="n">Main</span><span class="p">.</span><span class="n">HumanModel</span><span class="p">.</span><span class="n">BodyModel</span><span class="p">.</span><span class="n">Right</span><span class="p">.</span><span class="n">Leg</span><span class="p">.</span><span class="n">Seg</span><span class="p">.</span><span class="n">Foot</span>
    <span class="p">)</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>It consists of two parts; a top level class template
(<code class="docutils literal notranslate"><span class="pre">FootPlateConditionalContact</span></code>) that generate the conditional-contact code.
This code needs a few important arguments. The ground plane
(<code class="docutils literal notranslate"><span class="pre">PLATE_BASE_FRAME</span></code>) is a reference system where the ground plane is located.</p>
<p>Together with arguments <code class="docutils literal notranslate"><span class="pre">NORMAL_DIRECTION</span></code> this specifies the surface the
model is walking on. Another important argument is the <code class="docutils literal notranslate"><span class="pre">NODES_FOLDER</span></code>, which
is a folder that contains all the contacts points.</p>
<p>The contact points can be created manually, but to avoid this we use another
class-template (<code class="docutils literal notranslate"><span class="pre">CreateFootContactNodes25</span></code>) to create the nodes automatically.
As the name says it creates 25 nodes in the foot coordinate system. This part is
specific to the model implementation. One could also imagine class-templates
that produce a higher number of nodes or nodes in positions that corresponds to
particular shoes or on other body parts.</p>
<p>Of course, there are also many options that can be tweaked and adjusted.</p>
<div class="section" id="class-templates-footplateconditionalcontact">
<h3>Class templates: FootPlateConditionalContact<a class="headerlink" href="#class-templates-footplateconditionalcontact" title="Permalink to this headline">#</a></h3>
<p>Obligatory members are marked with <code class="docutils literal notranslate"><span class="pre">&lt;</span> <span class="pre">&gt;</span></code> and optional values are marked with
<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>. Default values are <strong>bold</strong>:</p>
<p><strong>Usage:</strong></p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">FootPlateConditionalContact</span> <span class="o">&lt;</span><span class="n">Object_name</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="n">NORMAL_DIRECTION</span>     <span class="o">=</span> <span class="s">&quot;&lt;X|Y|*Z&gt;&quot;</span><span class="p">,</span>
     <span class="n">NUMBER_OF_NODES</span>      <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="mf">1..200</span><span class="p">],</span>
     <span class="n">NODES_BASE_FOLDER</span>    <span class="o">=</span> <span class="o">&lt;</span><span class="kt">AnyFolder</span><span class="o">&gt;</span> <span class="p">,</span>
     <span class="n">PLATE_BASE_FRAME</span>     <span class="o">=</span> <span class="o">&lt;</span><span class="kt">AnyRefFrame</span><span class="o">&gt;</span><span class="p">,</span>
     <span class="n">SHOW_TRIGGER_VOLUME</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">Settings</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="p">[</span> <span class="n">LimitDistLow</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.10</span><span class="p">;</span>               <span class="p">]</span>
    <span class="p">[</span> <span class="n">LimitDistHigh</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">;</span>               <span class="p">]</span>
    <span class="p">[</span> <span class="n">LimitVelHigh</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span>                 <span class="p">]</span>
    <span class="p">[</span> <span class="n">GroundVelocity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>   <span class="p">]</span>
    <span class="p">[</span> <span class="n">Strength</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>                     <span class="p">]</span>
    <span class="p">[</span> <span class="n">FrictionCoefficient</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>          <span class="p">]</span>
    <span class="p">[</span> <span class="n">ScaleFactor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                    <span class="p">]</span>
    <span class="p">[</span> <span class="n">ForceVectorDrawScaleFactor</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;]</span>
  <span class="p">};</span>
</pre></div>
</div>
<p><strong>Class arguments:</strong></p>
<dl class="simple myst">
<dt><code class="docutils literal notranslate"><span class="pre">PLATE_BASE_FRAME</span></code>:</dt><dd><p>Is a AnyRefFrame object where the ground planes is attached.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NORMAL_DIRECTION</span></code>:</dt><dd><p>Defines the normal direction of the ground plane
the in PLATE_BASE_FRAME coordinate system.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NODES_BASE_FOLDER</span></code> :</dt><dd><p>The folder where all contact nodes are located below.
contact nodes must be AnyRefNodes named must be named <code class="docutils literal notranslate"><span class="pre">Node#</span></code>
where <code class="docutils literal notranslate"><span class="pre">#</span></code> is a number. Eg. <code class="docutils literal notranslate"><span class="pre">Node1`</span> <span class="pre">...``Node24</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NUMBER_OF_NODES</span></code>:</dt><dd><p>The number of contact nodes to expect within <code class="docutils literal notranslate"><span class="pre">NODE_BASE_FRAME</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SHOW_TRIGGER_VOLUME</span></code>:</dt><dd><p>Visualize the volume where contacts may be triggered.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">GLOBAL_REF</span></code>:</dt><dd><p>The global reference. This must be set if the global reference is not
<code class="docutils literal notranslate"><span class="pre">Main.EnvironmentModel.GlobalRef</span></code></p>
</dd>
</dl>
<p><strong>Optional initialization:</strong></p>
<dl class="simple myst">
<dt><code class="docutils literal notranslate"><span class="pre">Settings.LimitDistLow</span></code>:</dt><dd><p>Lower bound of the contact detection volume.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Settings.LimitDistHigh</span></code>:</dt><dd><p>Upper bound of the contact detection volume.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Settings.LimitVelHigh</span></code>:</dt><dd><p>Velocity threshold for contact detection.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Settings.Strength</span></code>:</dt><dd><p>Strength of the contact elements.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Settings.FrictionCoefficient</span></code>:</dt><dd><p>Friction coeficient of the contact elements. This adds limits to the amount of
friction force which can be recruited.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Settings.ForceVectorDrawScaleFactor</span></code>:</dt><dd><p>Scale factor for the drawing of the GRF force vector</p>
</dd>
</dl>
</div>
</div>
</div>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The AnyMoCap Framework</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By AnyBody Technology<br/>
  
      &copy; Copyright 2022, AnyBody Technology.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>